<!DOCTYPE html>
<html>
    <head>
        <title></title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width">
	<script src="../jquery.js"></script>
        <script src="firera.js"></script>
    </head>
    <body>
	<input type="file" class="flpt" id="flpt" />
<script>
(function () {
    var uploaded_files = {};
    var formdata = false;



   $(".flpt").change(function (evt) {
        //document.getElementById("response").innerHTML = "Uploading . . ."
	console.dir(this.files);
        var i = 0, len = this.files.length, img, reader, file;
        if (window.FormData) {
                formdata = new FormData();
        }

        for ( ; i < len; i++ ) {
                file = this.files[i];
                if(uploaded_files[file.name]){
                    continue;
                } else {
                    uploaded_files[file.name] = true;
                }

                if (!!file.type.match(/image.*/)) {
                        if ( window.FileReader ) {
                                reader = new FileReader();
                                reader.onloadend = (function (fl) {
                                    return function(e){
                                        //alert('we show ' + fl);
                                        showPhoto(e.target.result, fl);
                                    }
                                })(file.name);
                                reader.readAsDataURL(file);
                        }
                        if (formdata) {
                                formdata.append("images[]", file);
                        }
                }	
        }

        if (formdata) {
                $(".loadbar").show();
                $(".save-butt").hide();
                $.ajax({
                        url: "/photo_upload.php",
                        type: "POST",
                        data: formdata,
                        processData: false,
                        contentType: false,
                        success: function (res) {
                            var data = JSON.parse(res);
                            $(".loadbar").hide();
                            $(".save-butt").show();
                            if(data.data){
                                for(var i in data.data){
                                    $("li[data-orig=" + i.replace(/\./g, "-").toLowerCase() + "]").attr('data-id', data.data[i]);
                                }
                            }
                        }
                });
        }
    });
}());

</script>	
    </body>
</html>